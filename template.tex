\documentclass{article} % Устанавливаем класс документа на article

% Подключение пакетов для улучшения вывода текста
\usepackage{upquote} % Прямые кавычки в среде verbatim
\usepackage[]{microtype} % Улучшение типографики
\UseMicrotypeSet[protrusion]{basicmath} % Отключение отступов для шрифтов tt

\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
    \IfFileExists{parskip.sty}{%
        \usepackage{parskip} % Загружает пакет для управления отступами
    }{% else
        \setlength{\parindent}{0pt} % Убираем отступы
        \setlength{\parskip}{6pt plus 2pt minus 1pt} % Устанавливаем межстрочные расстояния
    }
}{% if KOMA class
    \KOMAoptions{parskip=half} % Настройки KOMA класса
}
\makeatother

% Подсветка кода
\usepackage{color} % Подключаем цвет для выделения
\usepackage{fancyvrb} % Улучшенная поддержка verbatim
\newcommand{\VerbBar}{|} % Определение символа для verbatim
\usepackage{fvextra} % Улучшенная поддержка verbatim
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,breakanywhere,commandchars=\\\{\}} % Окружение для подсветки 

% Параметры изображений
\usepackage{graphicx} % Подключаем пакет для работы с изображениями
\makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi} % Максимальная ширина изображения
    \def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi} % Максимальная высота изображения
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio} % Масштабирование изображений

\makeatletter
    \def\fps@figure{htbp} % Параметры размещения фигур
\makeatother

% Шрифты
\usepackage{fontspec} % Позволяет использовать любые шрифты
\setmainfont[Extension=.ttf,Path=/usr/share/fonts/ttf/pandoc-fonts/notion-fonts/segoeui-,UprightFont=regular,ItalicFont=italic,BoldFont=bold,BoldItalicFont=bolditalic]{} % Основной шрифт
\setmonofont[Extension=.otf,Path=/usr/share/fonts/otf/pandoc-fonts/notion-fonts/sfmono-,UprightFont=medium]{} % Моноширинный шрифт

% Управление цветами
\usepackage[table]{xcolor} % Подключаем поддержку цветных таблиц
% Определяем палитру цветов
\definecolor{PrimaryColor}{HTML}{37352F} % Основной цвет
\definecolor{BackgroundDarkColor}{HTML}{F7F6F3} % Темный фон
\definecolor{DarkTraitColor}{HTML}{E9E9E7} % Цвет для текстов
\definecolor{LightTrait100Color}{HTML}{ECEDEC} % Светлый оттенок
\definecolor{LightTrait200Color}{HTML}{C70000} % Цвет для акцентов
\definecolor{LightTrait300Color}{HTML}{37352F} % Цвет для заголовков
\definecolor{LightTrait400Color}{HTML}{F7F6F3} % Светлый фон
\definecolor{TextColor}{HTML}{37352F} % Цвет основного текста
\definecolor{TextSecondaryColor}{HTML}{73726E} % Вторичный текст
\definecolor{CodeColor}{HTML}{9A6E3A} % Цвет для кода
\definecolor{InlineCodeColor}{HTML}{EC5757} % Цвет для инлайн кода
\definecolor{ShadedTextColor}{HTML}{999999} % Цвет затененного текста
\definecolor{ShadeColor}{HTML}{F7F6F3} % Цвет затененного фона
\definecolor{TableEvenColor}{HTML}{F7F7F7} % Цвет четных строк таблицы
\definecolor{TableOddColor}{HTML}{FDFDFD} % Цвет нечетных строк таблицы
\definecolor{CheckedColor}{HTML}{2EAADC} % Цвет для выделенных
\definecolor{QuoteBackgroundColor}{HTML}{F7F7F7} % Цвет фона для цитат

% Настройки типографики
\setlength{\emergencystretch}{3em} % Ограничение на переполнение текста
\providecommand{\tightlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}} % Упаковка списков
\setcounter{secnumdepth}{-\maxdimen} % Убираем нумерацию секций
\newlength{\px} % Определение новой длины
\setlength{\px}{0.0104166667in} % Установка значения

% Настрока подчеркивания
\usepackage{soul} % Пакет для подчеркивания
\setul{0.175em}{0.06em} % Установки для подчеркивания

% Настройка ссылок
\usepackage[colorlinks=true,allcolors=TextColor!60!white,hidelinks]{hyperref} % Настройки гиперссылок

% Настройки верстки
\usepackage[a4paper,top=30\px,left=30\px,right=30\px,bottom=100\px,textwidth=860\px]{geometry} % Размер бумаги и отступы

% Заголовки
\usepackage{sectsty} % Настройки стиля заголовков
\usepackage{titlesec} % Пакет для форматирования заголовков
% Настройки для разделов
\titleformat{\section}{\fontsize{2.2em}{1.3\baselineskip}\bfseries}{}{}{} % Настройки для заголовков секций
\titlespacing{\section}{0pt}{2em}{0.3em} % Настройки отступов для секций
\titleformat{\subsection}{\fontsize{1.75em}{1.225\baselineskip}\bfseries}{}{}{} % Настройки для заголовков подсекций
\titlespacing{\subsection}{0pt}{2em}{0.3em} % Настройки отступов для подсекций
\titleformat{\subsubsection}{\fontsize{1.2em}{1.43\baselineskip}\bfseries}{}{}{} % Настройки для заголовков подподсекций
\titlespacing{\subsubsection}{0pt}{2em}{1em} % Настройки отступов для подподсекций
\titleformat{\paragraph}{\fontsize{1.2em}{1.4\baselineskip}\bfseries}{}{}{} % Настройки для заголовков параграфов
\titlespacing{\paragraph}{0pt}{2em}{1em} % Настройки отступов для параграфов
\titleformat{\subparagraph}{\fontsize{1em}{1.4\baselineskip}\bfseries}{}{}{} % Настройки для заголовков подпараграфов
\titlespacing{\subparagraph}{0pt}{2em}{1em} % Настройки отступов для подпараграфов

% Стиль цитат
\renewenvironment{quote}{
	\begin{tcolorbox}[
		notitle,
		frame hidden,
		interior hidden,
		sharp corners,
		enhanced,
		boxrule=0pt,
		colback=QuoteBackgroundColor,
		coltext=TextColor,
		boxsep=0em,
		top=10\px,
		right=14\px,
		bottom=7\px,
		left=22\px,
		borderline west={4\px}{0pt}{TextColor}
	]
}{
	\end{tcolorbox}
	\color{TextColor} % Устанавливаем цвет текста
}

\makeatletter
    \color{TextColor}\global\let\default@color\current@color % Установка глобального цвета
\makeatother

\usepackage[fontsize=0.16666672in]{fontsize} % Установка размера шрифта
\linespread{1.33} % Установка расстояний между строками

% Фон для кода
\usepackage[most]{tcolorbox} % Пакет для работы с цветными текстовыми блоками
\usepackage{setspace} % Пакет для установки межстрочного интервала
\newenvironment{Shaded}{ % Окружение для затененного текста
	\begin{tcolorbox}[
		notitle,
		breakable,
		frame hidden,
		arc=4\px,
		outer arc=4\px,
		enhanced,
		boxrule=0pt,
		colback=ShadeColor,
		coltext=ShadedTextColor,
		boxsep=0em,
		top=2\px,
		right=4\px,
		bottom=0\px,
		left=4\px,
        code={\singlespacing},
		fontupper=\fontsize{0.85em}{\baselineskip} % Установить размер шрифта в окружении
	]
}{
	\end{tcolorbox}
}

% Подсветка синтаксиса - взято из CodeMirror
\newcommand{\AlertTok}[1]{#1} % Отображение предупреждений
\newcommand{\AnnotationTok}[1]{#1} % Отображение аннотаций
\newcommand{\AttributeTok}[1]{\textcolor[HTML]{0277AA}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Атрибуты
\newcommand{\BaseNTok}[1]{#1} % Базовые элементы, без форматирования
\newcommand{\BuiltInTok}[1]{\textcolor[HTML]{669900}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Встроенные функции
\newcommand{\CharTok}[1]{#1} % Символы (буквы)
\newcommand{\CommentTok}[1]{\textcolor[HTML]{708090}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Комментарии
\newcommand{\CommentVarTok}[1]{#1} % Переменные в комментариях, без форматирования
\newcommand{\ConstantTok}[1]{#1} % Константы, без форматирования
\newcommand{\ControlFlowTok}[1]{#1} % Управляющие структуры (например, if, else, for)
\newcommand{\DataTypeTok}[1]{\textcolor[HTML]{48FF00}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Типы данных
\newcommand{\DecValTok}[1]{\textcolor[HTML]{990055}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Десятичные значения
\newcommand{\DocumentationTok}[1]{#1} % Документирование, без форматирования
\newcommand{\ErrorTok}[1]{\textcolor[HTML]{FF5A5A}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Ошибки
\newcommand{\ExtensionTok}[1]{#1} % Расширения, без форматирования
\newcommand{\FloatTok}[1]{\textcolor[HTML]{990055}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Числа с плавающей запятой
\newcommand{\FunctionTok}[1]{\textcolor{TextColor}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Функции
\newcommand{\ImportTok}[1]{#1} % Импорт, без форматирования
\newcommand{\InformationTok}[1]{#1} % Информация, без форматирования
\newcommand{\KeywordTok}[1]{\textcolor[HTML]{0277AA}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Ключевые слова
\newcommand{\NormalTok}[1]{\textcolor{TextColor}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Обычные элементы
\newcommand{\OperatorTok}[1]{\textcolor[HTML]{9A6E3B}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Операторы
\newcommand{\OtherTok}[1]{#1} % Другие элементы, без форматирования
\newcommand{\PreprocessorTok}[1]{#1} % Препроцессорные директивы, без форматирования
\newcommand{\RegionMarkerTok}[1]{#1} % Маркеры области, без форматирования
\newcommand{\SpecialCharTok}[1]{\textcolor[HTML]{669900}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Специальные символы
\newcommand{\SpecialStringTok}[1]{\textcolor[HTML]{669900}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Специальные строки
\newcommand{\StringTok}[1]{\textcolor[HTML]{669900}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Строки
\newcommand{\VariableTok}[1]{\textcolor[HTML]{37352F}{\FancyVerbBreakStart#1\FancyVerbBreakStop}} % Переменные
\newcommand{\VerbatimStringTok}[1]{#1} % Вербатим строки
\newcommand{\WarngingTok}[1]{#1} % Предупреждения

% Кодировка и язык
\usepackage[utf8]{inputenc} % Кодировка UTF-8
\usepackage[T2A]{fontenc}   % Поддержка кириллицы
\usepackage[russian]{babel} % Подключаем поддержку русского языка

% Заголовок документа
\title{\textbf{$title$}}    % Добавляем значение title из метаданных исходника
\author{$author$}           % Добавляем значение author из метаданных исходника
\date{$date$}               % Добавляем значение date из метаданных исходника

% Начало документа
\begin{document}

% Добавляем титульную страницу
\maketitle
\newpage

% Добавляем страницу содержания
\tableofcontents
\newpage

% Выводим всё остальное тело
$body$

\end{document}